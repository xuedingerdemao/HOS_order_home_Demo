import router from '@ohos.router'
import { EcList, ResManager } from '@orderHome/common/basic'

class Params {
  page: number = 1
  pageSize: number = 10
}

@Component
export struct Duty {
  @StorageProp('topHeight')
  topHeight: number = 0
  @State
  list: number[] = []
  // è¯·æ±‚å‚æ•°
  params: Params = { page: 1, pageSize: 10 }
  // åŠ è½½çŠ¶æ€
  @State
  finished: boolean = false
  // åŠ è½½ä¸­loading
  @State
  loading: boolean = false
  // åˆ·æ–°ä¸­
  @State
  isRefreshing: boolean = false
  /*-----------------------ðŸ‘‡ðŸ‘‡ function ðŸ‘‡ðŸ‘‡--------------------------------*/
  // è§¦åº•åŠ è½½æ•°æ®
  load = () => {
    if (this.loading || this.finished) {
      return
    }
    this.loading = true
    // è¯·æ±‚æ•°æ®
    setTimeout(() => {
      for (let index = 0; index < this.params.pageSize; index++) {
        this.list.push(this.list.length + 1)
      }
      this.loading = false
      // åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ›´å¤š
      if (this.list.length === 30) {
        this.finished = true
      } else {
        this.params.page++
      }

    }, 1000)
  }
  // åˆ·æ–°åˆ—è¡¨
  refresh = () => {
    setTimeout(() => {
      //  é‡ç½®åˆ—è¡¨å’ŒçŠ¶æ€
      this.loading = false
      this.finished = false
      // é‡ç½®è¯·æ±‚å‚æ•°
      this.params.page = 1
      this.list = Array.from(new Array(10))
        .map((item: null, i: number) => i + 1)
      // å…³é—­åˆ·æ–°çŠ¶æ€
      this.isRefreshing = false
    }, 2000)
  }

  build() {
    Column() {
      // æ ‡é¢˜
      Row() {
        Text('è´Ÿè´£è€äºº')
          .fontSize(24)
          .fontColor('#000')
          .fontWeight(500)
      }
      .padding({
        left: 24,
        right: 24,
        bottom: 10,
        top: 10
      })
      .width('100%')
      .justifyContent(FlexAlign.Start)

      // åˆ—è¡¨
      Column() {
        EcList({
          loading: this.loading,
          finished: this.finished,
          isRefreshing: $isRefreshing,
          load: this.load,
          refresh: this.refresh
        }) {
          ForEach(this.list, (item: number) => {
            ListItem() {
              Row({ space: 14 }) {
                // å¤´åƒ
                Image('https://img1.baidu.com/it/u=1944934302,3144710326&fm=253&fmt=auto&app=138&f=JPEG?w=190&h=190')
                  .width(80)
                  .height(80)
                  .borderRadius(ResManager.EC_NORMAL_RD)
                // ä¿¡æ¯
                Column({ space: 6 }) {
                  Row({ space: 15 }) {
                    Text('æŽçŽ‰è™Ž')
                      .fontColor(ResManager.EC_MID_BLACK)
                      .fontSize(ResManager.EC_PAGE_TITLE_FS)
                      .fontWeight(500)
                      .margin({ bottom: 5 })
                    Text('64å²')
                      .fontColor(ResManager.EC_MID_59)
                      .fontSize(13)
                    Text('ç”·')
                      .width(36)
                      .height(20)
                      .borderRadius(10)// å¥³bgï¼š#FFF0D9
                      .backgroundColor('#DBF0FF')
                      .textAlign(TextAlign.Center)
                      .fontColor(ResManager.EC_SUB_BLUE)
                      .fontSize(ResManager.EC_SMALL_FS)
                  }

                  Text('åºŠä½ï¼šå››äººé—´-1012åºŠ')
                    .fontColor(ResManager.EC_MID_59)
                    .fontSize(13)
                  Text('æŠ¤ç†ç­‰çº§ï¼šç‰¹çº§æŠ¤ç†')
                    .fontColor(ResManager.EC_MID_59)
                    .fontSize(13)

                  // æ“ä½œ
                  Row() {
                    Button('å¥åº·æ•°æ®')
                      .height(28)
                      .backgroundColor(ResManager.EC_MAIN_COLOR)
                      .fontSize(ResManager.EC_NORMAL_FS)
                      .margin({ right: 13 })
                      .onClick(() => {
                        router.pushUrl({
                          url: 'pages/duty/HealthDataPage'
                        })
                      })
                    Button('æŠ¤ç†ä»»åŠ¡')
                      .height(28)
                      .backgroundColor(ResManager.EC_MAIN_COLOR)
                      .fontSize(ResManager.EC_NORMAL_FS)
                      .onClick(() => {
                        router.pushUrl({
                          url: 'pages/duty/CareTaskPage',
                          params: this.params
                        })
                      })
                  }
                  .margin({ top: 17 })
                  .width('100%')
                  .justifyContent(FlexAlign.End)
                }
                // .width('100%')
                .layoutWeight(1)
                .alignItems(HorizontalAlign.Start)
              }
              .width('100%')
              .alignItems(VerticalAlign.Top)
              .borderRadius(ResManager.EC_NORMAL_RD)
              .backgroundColor(ResManager.EC_MID_WHITE)
              .padding({
                left: 14,
                right: 14,
                top: 16,
                bottom: 16
              })
            }
          })
        }
      }
      .layoutWeight(1)
      .padding({ left: 15, right: 15 })
    }
    .width('100%')
    .height('100%')
    .padding({ top: this.topHeight })
    .backgroundColor(ResManager.EC_MID_BG)
  }
}
